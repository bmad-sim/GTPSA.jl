<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quickstart Guide · GTPSA.jl</title><meta name="title" content="Quickstart Guide · GTPSA.jl"/><meta property="og:title" content="Quickstart Guide · GTPSA.jl"/><meta property="twitter:title" content="Quickstart Guide · GTPSA.jl"/><meta name="description" content="Documentation for GTPSA.jl."/><meta property="og:description" content="Documentation for GTPSA.jl."/><meta property="twitter:description" content="Documentation for GTPSA.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GTPSA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Quickstart Guide</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-GTPSA"><span>Defining the GTPSA</span></a></li><li><a class="tocitem" href="#Calculating-a-TPS"><span>Calculating a TPS</span></a></li><li><a class="tocitem" href="#Partial-Derivative-Getting/Setting"><span>Partial Derivative Getting/Setting</span></a></li><li><a class="tocitem" href="#Slicing-a-TPS"><span>Slicing a TPS</span></a></li><li><a class="tocitem" href="#@FastGTPSA-Macro"><span><code>@FastGTPSA</code> Macro</span></a></li><li><a class="tocitem" href="#Promotion-of-TPS-to-ComplexTPS"><span>Promotion of <code>TPS</code> to <code>ComplexTPS</code></span></a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../man/a_toc/">Table of Contents</a></li><li><a class="tocitem" href="../man/b_definitions/">Definitions</a></li><li><a class="tocitem" href="../man/c_descriptor/"><code>Descriptor</code></a></li><li><a class="tocitem" href="../man/d_tps/"><code>TPS</code></a></li><li><a class="tocitem" href="../man/e_complextps/"><code>ComplexTPS</code></a></li><li><a class="tocitem" href="../man/f_varsparams/"><code>vars</code>, <code>params</code></a></li><li><a class="tocitem" href="../man/g_monoindex/">Monomial Indexing</a></li><li><a class="tocitem" href="../man/h_mono/"><code>mono</code>/<code>complexmono</code></a></li><li><a class="tocitem" href="../man/i_gjh/"><code>gradient</code>, <code>jacobian</code>, <code>hessian</code></a></li><li><a class="tocitem" href="../man/j_slice/">Slicing and <code>par</code></a></li><li><a class="tocitem" href="../man/k_methods/">TPS Methods</a></li><li><a class="tocitem" href="../man/l_fastgtpsa/"><code>@FastGTPSA</code></a></li><li><a class="tocitem" href="../man/m_io/">I/O</a></li><li><a class="tocitem" href="../man/n_global/">Global Variables</a></li><li><a class="tocitem" href="../man/o_all/">All Overloaded Functions</a></li></ul></li><li><a class="tocitem" href="../devel/">For Developers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Quickstart Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quickstart Guide</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bmad-sim/GTPSA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bmad-sim/GTPSA.jl/blob/main/docs/src/quickstart.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quickstart-Guide"><a class="docs-heading-anchor" href="#Quickstart-Guide">Quickstart Guide</a><a id="Quickstart-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Quickstart-Guide" title="Permalink"></a></h1><h2 id="Defining-the-GTPSA"><a class="docs-heading-anchor" href="#Defining-the-GTPSA">Defining the GTPSA</a><a id="Defining-the-GTPSA-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-GTPSA" title="Permalink"></a></h2><p>A <code>Descriptor</code> defines all information about the GTPSA, including the number of variables and truncation orders for each variable. The constructors for a <code>Descriptor</code> including only variables are:</p><pre><code class="language-julia hljs"># 2 variables with max truncation order 10
d1 = Descriptor(2, 10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GTPSA Descriptor
-----------------------
Maximum order:     10
# Variables:       2
</code></pre><pre><code class="language-julia hljs"># 3 variables with individual truncation orders 1, 2, 3 and max truncation order 6
d2 = Descriptor([1, 2, 3], 6)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GTPSA Descriptor
-----------------------
Maximum order:     6
# Variables:       3
Variable orders:  [1, 2, 3]
</code></pre><h2 id="Calculating-a-TPS"><a class="docs-heading-anchor" href="#Calculating-a-TPS">Calculating a TPS</a><a id="Calculating-a-TPS-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-a-TPS" title="Permalink"></a></h2><p>After defining a <code>Descriptor</code> for the TPSA, the variables (which themselves are represented as <code>TPS</code>s) can be obtained using <code>vars</code> or <code>complexvars</code>. For example, to calculate the Taylor series for <span>$f(x_1,x_2) = \cos{(x_1)} + \sqrt{1+x_2}$</span> to 4th order in <span>$x_1$</span> and but only 1st order in <span>$x_2$</span> (up to maximally 1 + 4 = 5th order):</p><pre><code class="language-julia hljs">d = Descriptor([4, 1], 5);

# Returns a Vector of each variable as a TPS
x = vars(d)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{TPS}:
  Out  Coefficient                Order   Exponent
----------------------------------------------------
   1:   1.0000000000000000e+00      1      1   0
----------------------------------------------------
   2:   1.0000000000000000e+00      1      0   1
</code></pre><p>These <code>TPS</code>s can then be manipulated just like any other mathematical quantity in Julia:</p><pre><code class="language-julia hljs">f = cos(x[1]) + sqrt(1 + x[2])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Exponent
  2.0000000000000000e+00      0      0   0
  5.0000000000000000e-01      1      0   1
 -5.0000000000000000e-01      2      2   0
  4.1666666666666664e-02      4      4   0
</code></pre><p>A blank <code>TPS</code> or <code>ComplexTPS</code>, with all coefficients equal to zero, can be created using <code>TPS(use=d)</code> or <code>ComplexTPS(use=d)</code> respectively. If <code>use</code> is not explicitly passed, then the global <code>GTPSA.desc_current</code>, which is set each time a new <code>Descriptor</code> is defined, will be used.</p><p>When a TPS contains a lot of variables, the default output showing each variable exponent can be larger than the screen can show. A global variable <code>GTPSA.show_sparse</code>, which is by default set to <code>false</code>, can be set to <code>true</code> to instead show each specific monomial instead of the exponents for each variable:</p><pre><code class="language-julia hljs">d = Descriptor(10, 10);
x = vars(d);

GTPSA.show_sparse = true;
g = sin(x[1]*x[3]^2) + cos(x[2]*x[7]);

print(g)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Monomial
  1.0000000000000000e+00      0     1
  1.0000000000000000e+00      3     (x₁)¹ (x₃)²
 -5.0000000000000000e-01      4     (x₂)² (x₇)²
  4.1666666666666664e-02      8     (x₂)⁴ (x₇)⁴
 -1.6666666666666666e-01      9     (x₁)³ (x₃)⁶</code></pre><p>Another global variable <code>GTPSA.show_eps</code> can be set to exclude showing monomials with coefficients having an absolute value less than <code>GTPSA.show_eps</code>.</p><h2 id="Partial-Derivative-Getting/Setting"><a class="docs-heading-anchor" href="#Partial-Derivative-Getting/Setting">Partial Derivative Getting/Setting</a><a id="Partial-Derivative-Getting/Setting-1"></a><a class="docs-heading-anchor-permalink" href="#Partial-Derivative-Getting/Setting" title="Permalink"></a></h2><h3 id="Individual-Monomial-Coefficient"><a class="docs-heading-anchor" href="#Individual-Monomial-Coefficient">Individual Monomial Coefficient</a><a id="Individual-Monomial-Coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#Individual-Monomial-Coefficient" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The value of a partial derivative is equal to the monomial coefficient in the Taylor series multiplied by a constant factor. E.g. for an expansion around zero <span>$f(x)\approx f(0) + \frac{\partial f}{\partial x}\rvert_0x + \frac{1}{2!}\frac{\partial^2 f}{\partial x^2}\rvert_0 x^2 + ...$</span>, the 2nd order monomial coefficient is <span>$\frac{1}{2!}\frac{\partial^2 f}{\partial x^2}\rvert_0$</span>. </p></div></div><p>Individual monomial coefficients in a TPS <code>t</code> can be get/set with three methods of indexing:</p><ol><li><strong>By Order:</strong> <code>t[[&lt;x_1 order&gt;, ..., &lt;x_nv order&gt;]]</code>. For example, for a TPS with three variables <span>$x_1$</span>, <span>$x_2$</span>, and <span>$x_3$</span>, the <span>$x_1^3x_2^1$</span> monomial coefficient is accessed with <code>t[[3,1,0]]</code> or equivalently <code>t[[3,1]]</code>, as leaving out trailing zeros for unincluded variables is allowed. A tuple is also allowed instead of a vector for the list of orders.</li><li><strong>By Sparse Monomial</strong> <code>t[[&lt;ix_var&gt; =&gt; &lt;order&gt;, ...]]</code>. This method of indexing is convenient when a TPS contains many variables and parameters. For example, for a TPS with variables <span>$x_1,x_2,...x_{100}$</span>, the <span>$x_{1}^3x_{99}^1$</span> monomial coefficient is accessed with <code>t[[1=&gt;3, 99=&gt;1]]</code>. A tuple is also allowed instead of a vector for the list of pairs.</li><li><strong>By Monomial Index</strong> <code>t[idx]</code>. <em>This method is not recommended for indexing above first order.</em> Indexes the TPS with all monomials sorted by order. For example, for a TPS with two variables <span>$x_1$</span> and <span>$x_2$</span>, the <span>$x_1$</span> monomial is indexed with <code>t[1]</code> and the <span>$x_1^2$</span> monomial is indexed with <code>t[3]</code>. The zeroth order part, or the <em>scalar</em> part of the TPS, can be set with <code>t[0]</code>. This method requires zero allocations for indexing, unlike the other two.</li></ol><p>These three methods of indexing are best shown with an example:</p><pre><code class="language-julia hljs"># Example of indexing by order -----------
d = Descriptor(3, 10);
t = TPS(use=d); # Create zero TPS based on d

t[[0]] = 1;
t[[1]] = 2;
t[[0,1]] = 3;
t[(0,0,1)] = 4;  # Tuples also allowed
t[(2,1,3)] = 5;

print(t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Exponent
  1.0000000000000000e+00      0      0   0   0
  2.0000000000000000e+00      1      1   0   0
  3.0000000000000000e+00      1      0   1   0
  4.0000000000000000e+00      1      0   0   1
  5.0000000000000000e+00      6      2   1   3</code></pre><pre><code class="language-julia hljs"># Example of indexing by sparse monomial -----------
d = Descriptor(3, 10);
t = TPS(use=d); # Create zero TPS based on d

t[[1=&gt;1]] = 2;
t[[2=&gt;1]] = 3;
t[[3=&gt;1]] = 4;
t[(1=&gt;2,2=&gt;1,3=&gt;3)] = 5;  # Tuples also allowed

print(t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Exponent
  2.0000000000000000e+00      1      1   0   0
  3.0000000000000000e+00      1      0   1   0
  4.0000000000000000e+00      1      0   0   1
  5.0000000000000000e+00      6      2   1   3</code></pre><pre><code class="language-julia hljs"># Example of indexing by monomial index -----------
d = Descriptor(3, 10);
t = TPS(use=d); # Create zero TPS based on d

t[0] = 0;
t[1] = 1;
t[2] = 2;
t[3] = 3;
t[4] = 4;
t[5] = 5;
t[6] = 6;
t[7] = 7;
t[8] = 8;
t[9] = 9;
t[10] = 10;
print(t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Exponent
  1.0000000000000000e+00      1      1   0   0
  2.0000000000000000e+00      1      0   1   0
  3.0000000000000000e+00      1      0   0   1
  4.0000000000000000e+00      2      2   0   0
  5.0000000000000000e+00      2      1   1   0
  6.0000000000000000e+00      2      0   2   0
  7.0000000000000000e+00      2      1   0   1
  8.0000000000000000e+00      2      0   1   1
  9.0000000000000000e+00      2      0   0   2
  1.0000000000000000e+01      3      3   0   0</code></pre><h3 id="Gradients,-Jacobians,-Hessians"><a class="docs-heading-anchor" href="#Gradients,-Jacobians,-Hessians">Gradients, Jacobians, Hessians</a><a id="Gradients,-Jacobians,-Hessians-1"></a><a class="docs-heading-anchor-permalink" href="#Gradients,-Jacobians,-Hessians" title="Permalink"></a></h3><p>The convenience getters <code>gradient</code>, <code>jacobian</code>, and <code>hessian</code> (as well as their corresponding in-place methods <code>gradient!</code>, <code>jacobian!</code>, and <code>hessian!</code>) are also provided for extracting partial derivatives from a TPS/Vector of TPSs. Note that these functions are not actually calculating anything - at this point the TPS should already have been propagated through the system, and these functions are just extracting the corresponding partial derivatives.</p><pre><code class="language-julia hljs"># 2nd Order TPSA with 100 variables
d = Descriptor(100, 2);
x = vars(d);

out = cumsum(x);

# Convenience getters for partial derivative extracting:
grad1 = gradient(out[1]);
J = jacobian(out);
h1 = hessian(out[1]);

# Also in-place getters
gradient!(grad1, out[1]);
jacobian!(J, out);
hessian!(h1, out[1]);</code></pre><h2 id="Slicing-a-TPS"><a class="docs-heading-anchor" href="#Slicing-a-TPS">Slicing a TPS</a><a id="Slicing-a-TPS-1"></a><a class="docs-heading-anchor-permalink" href="#Slicing-a-TPS" title="Permalink"></a></h2><p>Parts of a TPS with certain variable orders can be extracted by slicing the TPS. When indexing by order, a colon (<code>:</code>) can be used in place for a variable order to include all orders of that variable. If the last specified index is a colon, then the rest of the variable indices are assumed to be colons:</p><pre><code class="language-julia hljs">d = Descriptor(5, 10);
x = vars(d);

f = 2*x[1]^2*x[3] + 3*x[1]^2*x[2]*x[3]*x[4]^2*x[5] + 6*x[3] + 5;
g = f[[2,:,1]];
h = f[[2,:,1,:]];

print(f)
print(g)
print(h)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Exponent
  5.0000000000000000e+00      0      0   0   0   0   0
  6.0000000000000000e+00      1      0   0   1   0   0
  2.0000000000000000e+00      3      2   0   1   0   0
  3.0000000000000000e+00      7      2   1   1   2   1
TPS:
 Coefficient                Order   Exponent
  2.0000000000000000e+00      3      2   0   1   0   0
TPS:
 Coefficient                Order   Exponent
  2.0000000000000000e+00      3      2   0   1   0   0
  3.0000000000000000e+00      7      2   1   1   2   1</code></pre><p>A TPS can also be sliced with indexing by sparse monomial. In this case, if a colon is included anywhere in the sparse monomial index, then all orders of all variables not explicity specified will be included:</p><pre><code class="language-julia hljs"> # Colon position does not matter in sparse-monomial indexing
g = f[[1=&gt;2, :, 3=&gt;1, 4=&gt;0, 5=&gt;0]];
h = f[[1=&gt;2, 3=&gt;1, :]];


print(g)
print(h)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
 Coefficient                Order   Exponent
  2.0000000000000000e+00      3      2   0   1   0   0
TPS:
 Coefficient                Order   Exponent
  2.0000000000000000e+00      3      2   0   1   0   0
  3.0000000000000000e+00      7      2   1   1   2   1</code></pre><h2 id="@FastGTPSA-Macro"><a class="docs-heading-anchor" href="#@FastGTPSA-Macro"><code>@FastGTPSA</code> Macro</a><a id="@FastGTPSA-Macro-1"></a><a class="docs-heading-anchor-permalink" href="#@FastGTPSA-Macro" title="Permalink"></a></h2><p>The macro <code>@FastGTPSA</code> can be used to speed up evaluation of expressions that contain <code>TPS</code>s and/or <code>ComplexTPS</code>s. The macro is completely transparent to all other types, so it can be prepended to any existing expressions while still maintaining generic code. Any functions in the expression that are not overloaded by GTPSA will be ignored.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using GTPSA, BenchmarkTools</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; d = Descriptor(3, 5);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = vars(d);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @btime $x[1]^3*sin($x[2])/log(2+$x[3])-exp($x[1]*$x[2])*im;</code><code class="nohighlight hljs ansi" style="display:block;">  2.345 μs (10 allocations: 160 bytes)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @btime @FastGTPSA $x[1]^3*sin($x[2])/log(2+$x[3])-exp($x[1]*$x[2])*im;</code><code class="nohighlight hljs ansi" style="display:block;">  2.083 μs (1 allocation: 16 bytes)</code></pre><p>The advantages of using the macro become especially apparent in more complicated systems, for example in <code>benchmark/track.jl</code>. </p><h2 id="Promotion-of-TPS-to-ComplexTPS"><a class="docs-heading-anchor" href="#Promotion-of-TPS-to-ComplexTPS">Promotion of <code>TPS</code> to <code>ComplexTPS</code></a><a id="Promotion-of-TPS-to-ComplexTPS-1"></a><a class="docs-heading-anchor-permalink" href="#Promotion-of-TPS-to-ComplexTPS" title="Permalink"></a></h2><p><code>TPS</code>s and <code>ComplexTPS</code>s can be mixed freely without concern. Any time an operation with a <code>TPS</code> and a <code>ComplexTPS</code> or a <code>Complex</code> number occurs, the result will be a <code>ComplexTPS</code>. A <code>ComplexTPS</code> can be converted back to a <code>TPS</code> using the <code>real</code> and <code>imag</code> operators.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../man/a_toc/">Table of Contents »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Wednesday 10 April 2024 20:23">Wednesday 10 April 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
