<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage · GTPSA.jl</title><meta name="title" content="Usage · GTPSA.jl"/><meta property="og:title" content="Usage · GTPSA.jl"/><meta property="twitter:title" content="Usage · GTPSA.jl"/><meta name="description" content="Documentation for GTPSA.jl."/><meta property="og:description" content="Documentation for GTPSA.jl."/><meta property="twitter:description" content="Documentation for GTPSA.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GTPSA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Usage</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-TPSA"><span>Defining the TPSA</span></a></li><li><a class="tocitem" href="#Calculating-a-TPS"><span>Calculating a TPS</span></a></li><li><a class="tocitem" href="#Partial-Derivative-Getting/Setting"><span>Partial Derivative Getting/Setting</span></a></li><li><a class="tocitem" href="#Slicing-a-TPS"><span>Slicing a TPS</span></a></li><li><a class="tocitem" href="#@FastGTPSA-Macro"><span><code>@FastGTPSA</code> Macro</span></a></li><li><a class="tocitem" href="#Promotion-of-TPS-to-ComplexTPS"><span>Promotion of TPS to ComplexTPS</span></a></li></ul></li><li><a class="tocitem" href="../advanced/">Advanced Usage</a></li><li><a class="tocitem" href="../code/">Code Index</a></li><li><a class="tocitem" href="../devel/">For Developers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Usage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bmad-sim/GTPSA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bmad-sim/GTPSA.jl/blob/main/docs/src/usage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h1><h2 id="Defining-the-TPSA"><a class="docs-heading-anchor" href="#Defining-the-TPSA">Defining the TPSA</a><a id="Defining-the-TPSA-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-TPSA" title="Permalink"></a></h2><p>A <code>Descriptor</code> defines all information about the TPSA, including the number of variables and truncation orders for each variable. The constructors for a <code>Descriptor</code> are</p><pre><code class="language-julia hljs"># Descriptor for 2 variables with max order 10 for each
d1 = Descriptor(2, 10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GTPSA Descriptor
-----------------------
# Variables:       2
Variable order:    10
</code></pre><pre><code class="language-julia hljs"># Descriptor for 3 variables with orders 1, 2, 3 respectively
d2 = Descriptor([1, 2, 3])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GTPSA Descriptor
-----------------------
# Variables:       3
Variable orders:  [1, 2, 3]
</code></pre><h2 id="Calculating-a-TPS"><a class="docs-heading-anchor" href="#Calculating-a-TPS">Calculating a TPS</a><a id="Calculating-a-TPS-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-a-TPS" title="Permalink"></a></h2><p>After defining a <code>Descriptor</code> for the TPSA, the variables (which themselves are represented as <code>TPS</code>s) can be obtained using <code>vars</code> or <code>complexvars</code>. For example, to calculate the Taylor series for <span>$f(x_1,x_2) = \cos{(x_1)} + \sqrt{1+x_2}$</span> to 4th order in <span>$x_1$</span> and but only 1st order in <span>$x_2$</span>:</p><pre><code class="language-julia hljs">d = Descriptor([4, 1]);

# Returns a Vector of each variable as a TPS
x = vars(d)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{TPS}:
  Out   Coefficient              Order     Exponent
----------------------------------------------------
   1:    1.0000000000000000e+00    1        1    0
----------------------------------------------------
   2:    1.0000000000000000e+00    1        0    1
</code></pre><p>These <code>TPS</code>s can then be manipulated just like any other mathematical quantity in Julia:</p><pre><code class="language-julia hljs">f = cos(x[1]) + sqrt(1 + x[2])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
  Coefficient              Order     Exponent
   2.0000000000000000e+00    0        0    0
   5.0000000000000000e-01    1        0    1
  -5.0000000000000000e-01    2        2    0
   4.1666666666666664e-02    4        4    0
</code></pre><p>A blank <code>TPS</code> or <code>ComplexTPS</code>, with all coefficients equal to zero, can be created using <code>TPS(d)</code> or <code>ComplexTPS(d)</code> respectively. </p><p>When a TPS contains more than 6 variables, a different type of <code>show</code> is used, instead showing the specific monomial instead of the exponents for each variable:</p><pre><code class="language-julia hljs">d = Descriptor(10, 10);
x = vars(d);

g = sin(x[1]*x[3]^2) + cos(x[2]*x[7]);

print(g)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
  Coefficient              Order     Monomial
   1.0000000000000000e+00    0       1
   1.0000000000000000e+00    3       (x₁)¹ (x₃)²
  -5.0000000000000000e-01    4       (x₂)² (x₇)²
   4.1666666666666664e-02    8       (x₂)⁴ (x₇)⁴
  -1.6666666666666666e-01    9       (x₁)³ (x₃)⁶</code></pre><h2 id="Partial-Derivative-Getting/Setting"><a class="docs-heading-anchor" href="#Partial-Derivative-Getting/Setting">Partial Derivative Getting/Setting</a><a id="Partial-Derivative-Getting/Setting-1"></a><a class="docs-heading-anchor-permalink" href="#Partial-Derivative-Getting/Setting" title="Permalink"></a></h2><h3 id="Individual-Monomial-Coefficient"><a class="docs-heading-anchor" href="#Individual-Monomial-Coefficient">Individual Monomial Coefficient</a><a id="Individual-Monomial-Coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#Individual-Monomial-Coefficient" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The value of a partial derivative is equal to the monomial coefficient in the Taylor series multiplied by a constant factor. E.g. for an expansion around zero <span>$f(x)\approx f(0) + \frac{\partial f}{\partial x}\rvert_0x + \frac{1}{2!}\frac{\partial^2 f}{\partial x^2}\rvert_0 x^2 + ...$</span>, the 2nd order monomial coefficient is <span>$\frac{1}{2!}\frac{\partial^2 f}{\partial x^2}\rvert_0$</span>. </p></div></div><p>Individual monomial coefficients in a TPS <code>t</code> can be get/set with two methods of indexing:</p><ol><li><strong>By Order:</strong> <code>t[&lt;x_1 order&gt;, ..., &lt;x_nv order&gt;]</code>. For example, for a TPS with variables <span>$x_1$</span>, <span>$x_2$</span>, the <span>$x_1^3x_2^1$</span> monomial coefficient is accessed with <code>t[3,1]</code>. The 0th order part (the <em>scalar</em> part) of the TPS is indexed with <code>t[0,0]</code> or equivalently <code>t[0]</code>, as leaving out trailing zeros for unincluded variables is allowed.</li><li><strong>By Sparse Monomial</strong> <code>t[&lt;ix_var&gt; =&gt; &lt;order&gt;, ...]</code>. This method of indexing is convenient when a TPS contains many variables and parameters. For example, for a TPS with variables <span>$x_1,x_2,...x_{100}$</span>, the <span>$x_{1}^3x_{99}^1$</span> monomial coefficient is accessed with <code>t[1=&gt;3, 99=&gt;1]</code>. The scalar part of the TPS cannot be get/set with this method.</li></ol><p>These two methods of indexing are best shown with an example:</p><pre><code class="language-julia hljs"># Example of indexing by order -----------
d = Descriptor(3, 10);
t = TPS(d); # Create zero TPS based on d

t[0] = 1;
t[1] = 2;
t[0,1] = 3;
t[0,0,1] = 4;
t[2,1,3] = 5;

print(t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
  Coefficient              Order     Exponent
   1.0000000000000000e+00    0        0    0    0
   2.0000000000000000e+00    1        1    0    0
   3.0000000000000000e+00    1        0    1    0
   4.0000000000000000e+00    1        0    0    1
   5.0000000000000000e+00    6        2    1    3</code></pre><pre><code class="language-julia hljs"># Example of indexing by sparse monomial -----------
d = Descriptor(3, 10);
t = TPS(d); # Create zero TPS based on d

t[1=&gt;1] = 2;
t[2=&gt;1] = 3;
t[3=&gt;1] = 4;
t[1=&gt;2,2=&gt;1,3=&gt;3] = 5;

print(t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
  Coefficient              Order     Exponent
   2.0000000000000000e+00    1        1    0    0
   3.0000000000000000e+00    1        0    1    0
   4.0000000000000000e+00    1        0    0    1
   5.0000000000000000e+00    6        2    1    3</code></pre><h3 id="Gradients,-Jacobians,-Hessians"><a class="docs-heading-anchor" href="#Gradients,-Jacobians,-Hessians">Gradients, Jacobians, Hessians</a><a id="Gradients,-Jacobians,-Hessians-1"></a><a class="docs-heading-anchor-permalink" href="#Gradients,-Jacobians,-Hessians" title="Permalink"></a></h3><p>The convenience getters <code>gradient</code>, <code>jacobian</code>, and <code>hessian</code> (as well as their corresponding in-place methods <code>gradient!</code>, <code>jacobian!</code>, and <code>hessian!</code>) are also provided for extracting partial derivatives from a TPS/Vector of TPSs. Note that these functions are not actually calculating anything - at this point the TPS should already have been propagated through the system, and these functions are just extracting the corresponding partial derivatives.</p><pre><code class="language-julia hljs"># 2nd Order TPSA with 100 variables
d = Descriptor(100, 2);
x = vars(d);

out = cumsum(x);

# Convenience getters for partial derivative extracting:
grad1 = gradient(out[1]);
J = jacobian(out);
h1 = hessian(out[1]);

# Also in-place getters
gradient!(grad1, out[1]);
jacobian!(J, out);
hessian!(h1, out[1]);</code></pre><h2 id="Slicing-a-TPS"><a class="docs-heading-anchor" href="#Slicing-a-TPS">Slicing a TPS</a><a id="Slicing-a-TPS-1"></a><a class="docs-heading-anchor-permalink" href="#Slicing-a-TPS" title="Permalink"></a></h2><p>Parts of a <code>TPS</code> with certain variable orders can be extracted using the same indexing methods as above, but appending a colon (<code>:</code>) to the end of the indexing list:</p><pre><code class="language-julia hljs">d = Descriptor(4, 6);
x = vars(d);

f = 2*x[1]^2*x[3]*x[4] + 3*x[1]^2*x[3]*x[4]^2 + 6*x[3] + 5
g = f[1=&gt;2,3=&gt;1,:];

print(f)
print(g)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TPS:
  Coefficient              Order     Exponent
   5.0000000000000000e+00    0        0    0    0    0
   6.0000000000000000e+00    1        0    0    1    0
   2.0000000000000000e+00    4        2    0    1    1
   3.0000000000000000e+00    5        2    0    1    2
TPS:
  Coefficient              Order     Exponent
   2.0000000000000000e+00    1        0    0    0    1
   3.0000000000000000e+00    2        0    0    0    2</code></pre><h2 id="@FastGTPSA-Macro"><a class="docs-heading-anchor" href="#@FastGTPSA-Macro"><code>@FastGTPSA</code> Macro</a><a id="@FastGTPSA-Macro-1"></a><a class="docs-heading-anchor-permalink" href="#@FastGTPSA-Macro" title="Permalink"></a></h2><p>The macro <code>@FastGTPSA</code> can be used to speed up evaluation of expressions that contain <code>TPS</code>s and/or <code>ComplexTPS</code>s. The macro is completely transparent to all other types, so it can be prepended to any existing expressions while still maintaining generic code. Any functions in the expression that are not overloaded by GTPSA will be ignored.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using GTPSA, BenchmarkTools</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: ArgumentError: Package BenchmarkTools not found in current path.
- Run `import Pkg; Pkg.add(&quot;BenchmarkTools&quot;)` to install the BenchmarkTools package.</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; d = Descriptor(3, 5);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = vars(d);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @btime $x[1]^3*sin($x[2])/log(2+$x[3])-exp($x[1]*$x[2])*im;</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: LoadError: UndefVarError: `@btime` not defined
in expression starting at REPL[4]:1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @btime @FastGTPSA $x[1]^3*sin($x[2])/log(2+$x[3])-exp($x[1]*$x[2])*im;</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: LoadError: UndefVarError: `@btime` not defined
in expression starting at REPL[5]:1</code></pre><p>The advantages of using the macro become especially apparent in more complicated systems, for example in <code>benchmark/taylormap.jl</code>. To read about how it works, see <a href="../devel/#For-Developers">For Developers</a>.</p><h2 id="Promotion-of-TPS-to-ComplexTPS"><a class="docs-heading-anchor" href="#Promotion-of-TPS-to-ComplexTPS">Promotion of TPS to ComplexTPS</a><a id="Promotion-of-TPS-to-ComplexTPS-1"></a><a class="docs-heading-anchor-permalink" href="#Promotion-of-TPS-to-ComplexTPS" title="Permalink"></a></h2><p><code>TPS</code>s and <code>ComplexTPS</code>s can be mixed freely without concern. Any time an operation with a <code>TPS</code> and a <code>ComplexTPS</code> or a <code>Complex</code> number occurs, the result will be a <code>ComplexTPS</code>. A <code>ComplexTPS</code> can be converted back to a <code>TPS</code> using the <code>real</code> and <code>imag</code> operators.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../advanced/">Advanced Usage »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 31 January 2024 19:55">Wednesday 31 January 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
