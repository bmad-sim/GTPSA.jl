<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage · GTPSA.jl</title><meta name="title" content="Usage · GTPSA.jl"/><meta property="og:title" content="Usage · GTPSA.jl"/><meta property="twitter:title" content="Usage · GTPSA.jl"/><meta name="description" content="Documentation for GTPSA.jl."/><meta property="og:description" content="Documentation for GTPSA.jl."/><meta property="twitter:description" content="Documentation for GTPSA.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GTPSA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Usage</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-TPSA"><span>Defining the TPSA</span></a></li><li><a class="tocitem" href="#Calculating-a-TPS"><span>Calculating a TPS</span></a></li><li><a class="tocitem" href="#Partial-Derivative-Getting/Setting"><span>Partial Derivative Getting/Setting</span></a></li><li><a class="tocitem" href="#@FastGTPSA-Macro"><span><code>@FastGTPSA</code> Macro</span></a></li><li><a class="tocitem" href="#Promotion-of-TPS-to-ComplexTPS"><span>Promotion of TPS to ComplexTPS</span></a></li></ul></li><li><a class="tocitem" href="../taylor/">Taylor Maps</a></li><li><a class="tocitem" href="../code/">Code Index</a></li><li><a class="tocitem" href="../devel/">For Developers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Usage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bmad-sim/GTPSA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bmad-sim/GTPSA.jl/blob/main/docs/src/usage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h1><h2 id="Defining-the-TPSA"><a class="docs-heading-anchor" href="#Defining-the-TPSA">Defining the TPSA</a><a id="Defining-the-TPSA-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-TPSA" title="Permalink"></a></h2><p>The <code>Descriptor</code> defines all information about the TPSA, including the number of variables and orders for each variable. The constructors for a <code>Descriptor</code> are:</p><pre><code class="nohighlight hljs"># Descriptor for 2 variables with max order 10 for each
d1 = Descriptor(2, 10)      # Use this ctor when all variables have the same order

# Descriptor for 3 variables with orders 1, 2, 3 respectively
d2 = Descriptor([1, 2, 3])  # Use this ctor when variables have different truncation orders</code></pre><h2 id="Calculating-a-TPS"><a class="docs-heading-anchor" href="#Calculating-a-TPS">Calculating a TPS</a><a id="Calculating-a-TPS-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-a-TPS" title="Permalink"></a></h2><p>After defining a <code>Descriptor</code> for the TPSA, the variables (which themselves are represented as TPSs) can be obtained using <code>vars</code> or <code>complexvars</code>. For example, suppose we wish to calculate the Taylor series for <span>$f(x_1,x_2) = \cos{(x_1)} + \sqrt{1+x_2}$</span> to 4th order in <span>$x_1$</span> and but only 1st order in <span>$x_2$</span>:</p><pre><code class="nohighlight hljs">d = Descriptor([4, 1])

# Returns a Vector of each variable as a TPS
x = vars(d) 

# f is a TPS containing the result
f = cos(x[1]) + sqrt(1 + x[2])</code></pre><p>A blank <code>TPS</code> or <code>ComplexTPS</code>, with all coefficients equal to zero, can be created using <code>TPS(d)</code> or <code>ComplexTPS(d)</code> respectively. </p><h2 id="Partial-Derivative-Getting/Setting"><a class="docs-heading-anchor" href="#Partial-Derivative-Getting/Setting">Partial Derivative Getting/Setting</a><a id="Partial-Derivative-Getting/Setting-1"></a><a class="docs-heading-anchor-permalink" href="#Partial-Derivative-Getting/Setting" title="Permalink"></a></h2><h3 id="Individual-Partial-Derivatives"><a class="docs-heading-anchor" href="#Individual-Partial-Derivatives">Individual Partial Derivatives</a><a id="Individual-Partial-Derivatives-1"></a><a class="docs-heading-anchor-permalink" href="#Individual-Partial-Derivatives" title="Permalink"></a></h3><p>Individual monomial coefficients in a TPS <code>t</code> can be get/set with two methods of indexing:</p><ol><li><strong>By Order:</strong> <code>t[&lt;x_1 order&gt;, ..., &lt;x_nv order&gt;]</code>. For example, for a TPS with variables <span>$x_1$</span>, <span>$x_2$</span>, the <span>$x_1^3x_2^1$</span> monomial coefficient is accessed with <code>t[3,1]</code>. The 0th order part (the <em>scalar</em> part) of the TPS is indexed with <code>t[0,0]</code> or equivalently <code>t[0]</code>, as leaving out trailing zeros for unincluded variables is allowed.</li><li><strong>By Var =&gt; Order:</strong> <code>t[&lt;ix_var&gt; =&gt; &lt;order&gt;, ...]</code>. This method of indexing is convenient when a TPS contains many variables and parameters. For example, for a TPS with variables <span>$x_1,x_2,...x_{100}$</span>, the <span>$x_{1}^3x_{99}^1$</span> monomial is accessed with <code>t[1=&gt;3, 99=&gt;1]</code>. The scalar part of the TPS cannot be get/set with this method.</li></ol><pre><code class="nohighlight hljs"># Descriptor for 2 variables with order 5
d = Descriptor(2, 5)
x = vars(d)
x1 = x[1]
x2 = x[2]

# Example of indexing by order -------
y1 = TPS(d)             # Create blank TPS with zero for all coefficients
y1[1,0] = 1             # Set first-order part for first variable equal to 1
y1 == x1                # Is true

z2 = TPS(d)             # Create blank TPS with zero for all coefficients
z2[0,1] = 1             # Set first-order part for second variable equal to 1
z2 == x2                # Is true

# Example of indexing by var =&gt; order -------
y1 = TPS(d)             # Create blank TPS with zero for all coefficients
y1[1=&gt;1] = 1            # Set first-order part for first variable equal to 1
y1 == x1                # Is true

z2 = TPS(d)             # Create blank TPS with zero for all coefficients
z2[2=&gt;1] = 1            # Set first-order part for second variable equal to 1
z2 == x2                # Is true</code></pre><h3 id="Gradients,-Jacobians,-Hessians"><a class="docs-heading-anchor" href="#Gradients,-Jacobians,-Hessians">Gradients, Jacobians, Hessians</a><a id="Gradients,-Jacobians,-Hessians-1"></a><a class="docs-heading-anchor-permalink" href="#Gradients,-Jacobians,-Hessians" title="Permalink"></a></h3><p>The convenience getters <code>gradient</code>, <code>jacobian</code>, and <code>hessian</code> (as well as their corresponding in-place methods <code>gradient!</code>, <code>jacobian!</code>, and <code>hessian!</code>) are also provided for extracting certain monomial coefficients from a TPS/Vector of TPSs. Note that these functions are not actually calculating anything - at this point the TPS should already have been propagated through the system, and these functions are just extracting the corresponding partial derivatives.</p><pre><code class="nohighlight hljs"># 2nd Order TPSA with 100 variables
d = Descriptor(100, 2)
x = vars(d)

out = cumsum(x)

# Convenience getters for partial derivative extracting:
grad1 = gradient(out[1])
J = jacobian(out)
h1 = hessian(out[1])

# Also in-place getters
gradient!(grad1, out[1])
jacobian!(J, out)
hessian!(h1, out[1])</code></pre><h2 id="@FastGTPSA-Macro"><a class="docs-heading-anchor" href="#@FastGTPSA-Macro"><code>@FastGTPSA</code> Macro</a><a id="@FastGTPSA-Macro-1"></a><a class="docs-heading-anchor-permalink" href="#@FastGTPSA-Macro" title="Permalink"></a></h2><p>The macro <code>@FastGTPSA</code> can be used to speed up evaluation of expressions that contain <code>TPS</code>s and/or <code>ComplexTPS</code>s. The macro is completely transparent to all other types, so it can be prepended to any existing expressions while still maintaining generic code. Any functions in the expression that are not overloaded by GTPSA will be ignored.</p><pre><code class="nohighlight hljs">using BenchmarkTools

d = Descriptor(3, 5)
x = vars(d)

@btime $x[1]^3*sin($x[2])/log(2+$x[3])-exp($x[1]*$x[2])*im
# Output:  1.346 μs (10 allocations: 160 bytes)

 @btime @FastGTPSA $x[1]^3*sin($x[2])/log(2+$x[3])-exp($x[1]*$x[2])*im
# Output:  1.225 μs (1 allocation: 16 bytes)</code></pre><p>The advantages of using the macro become especially apparent in more complicated systems, for example in <code>benchmark/taylormap.jl</code>. To read about how it works, see <a href="../devel/#For-Developers">For Developers</a>.</p><h2 id="Promotion-of-TPS-to-ComplexTPS"><a class="docs-heading-anchor" href="#Promotion-of-TPS-to-ComplexTPS">Promotion of TPS to ComplexTPS</a><a id="Promotion-of-TPS-to-ComplexTPS-1"></a><a class="docs-heading-anchor-permalink" href="#Promotion-of-TPS-to-ComplexTPS" title="Permalink"></a></h2><p><code>TPS</code>s and <code>ComplexTPS</code>s can be mixed freely without concern. Any time an operation with a <code>TPS</code> and a <code>ComplexTPS</code> or a <code>Complex</code> number occurs, the result will be a <code>ComplexTPS</code>. A <code>ComplexTPS</code> can be converted back to a <code>TPS</code> using the <code>real</code> and <code>imag</code> operators.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../taylor/">Taylor Maps »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Monday 8 January 2024 01:13">Monday 8 January 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
